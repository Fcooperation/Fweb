<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Account Suspended</title>

<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #fff3cd;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }

  .message-box {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    max-width: 450px;
    width: 90%;
  }

  h2 {
    color: #856404;
    margin-bottom: 20px;
  }

  p {
    color: #856404;
    font-size: 16px;
  }

  a {
    color: #007bff;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  .timer {
    font-size: 18px;
    font-weight: bold;
    margin-top: 15px;
  }

  #backBtn {
    padding: 10px 20px;
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 20px;
    font-size: 15px;
    display: none; /* hidden by default */
  }

  #backBtn:hover {
    background: #0056b3;
  }
</style>
</head>
<body>
  <div class="message-box">
    <h2>Account Suspended</h2>
    <p id="welcome">Loading your info...</p>
    <p>Your account is suspended until:</p>
    <div class="timer" id="countdown">Loading...</div>
    <p>Review the <a href="privacy.html">Terms and Conditions</a>.</p>
    <button id="backBtn">Back to Login</button>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://pwsxezhugsxosbwhkdvf.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3c3hlemh1Z3N4b3Nid2hrZHZmIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MTkyODM4NywiZXhwIjoyMDY3NTA0Mzg3fQ.u7lU9gAE-hbFprFIDXQlep4q2bhjj0QdlxXF-kylVBQ";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const faccount = JSON.parse(localStorage.getItem("faccount"));
    const welcomeEl = document.getElementById("welcome");
    const countdownEl = document.getElementById("countdown");
    const backBtn = document.getElementById("backBtn");

    if (!faccount || !faccount.email) {
      welcomeEl.textContent = "No account info found.";
      countdownEl.textContent = "Unable to load suspension info.";
      backBtn.style.display = "inline-block";
    } else {
      const userEmail = faccount.email;

      async function fetchUser() {
        const { data, error } = await supabase
          .from("fwebaccount")
          .select("username, suspended_until")
          .eq("email", userEmail)
          .single();

        if (error || !data) {
          welcomeEl.textContent = "Unable to fetch account info.";
          countdownEl.textContent = "Error loading suspension info.";
          backBtn.style.display = "inline-block";
          return;
        }

        welcomeEl.textContent = `Hello, ${data.username}!`;

        const suspendedUTC = new Date(data.suspended_until);

        function updateCountdown() {
          const nowUTC = new Date(new Date().toISOString());
          const diff = suspendedUTC - nowUTC;

          if (diff <= 0) {
            countdownEl.textContent = "Your suspension has ended. Redirecting...";
            clearInterval(timerInterval);

            // Attempt redirect
            setTimeout(() => {
              try {
                window.location.href = "login.html";
              } catch {
                backBtn.style.display = "inline-block"; // fallback
              }
            }, 3000);

            // Safety fallback in case redirect fails
            setTimeout(() => {
              backBtn.style.display = "inline-block";
            }, 5000);
            return;
          }

          const days = Math.floor(diff / (1000 * 60 * 60 * 24));
          const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((diff % (1000 * 60)) / 1000);
          const localTime = suspendedUTC.toLocaleString();

          countdownEl.innerHTML = `
            <div>‚è∞ ${days}d ${hours}h ${minutes}m ${seconds}s remaining</div>
            <div>üïí Ends at: ${localTime}</div>
          `;
        }

        updateCountdown();
        const timerInterval = setInterval(updateCountdown, 1000);
      }

      fetchUser();
    }

    // Manual Back to Login button
    backBtn.addEventListener("click", () => {
      window.location.href = "login.html";
    });
  </script>
</body>
</html>
