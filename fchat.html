<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fchat</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f0f0;
  padding: 0;
  margin: 0;
}

/* ------- LOADING SCREEN ------- */
#loading-screen {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:20px;
  z-index:1000;
}

#loading-title {
  font-size:38px;
  font-weight:bold;
  padding:10px 20px;
  border-radius:8px;
  background:white;
  color:black;
  border:2px solid black;
}

#loading-logs {
  font-size:16px;
  color:#444;
  text-align:center;
}

/* ------- MAIN UI ------- */
#main-ui {
  display:none;
  padding:20px;
}

#users-list {
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:15px;
}

/* ------- FCARD ------- */
.fcard {
  background:white;
  border-radius:10px;
  padding:12px;
  display:flex;
  align-items:center;
  gap:14px;
  box-shadow:0 2px 5px rgba(0,0,0,0.15);
}

.pfp {
  width:60px;
  height:60px;
  border-radius:50%;
  object-fit:cover;
  background:black;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  font-size:22px;
  cursor:pointer;
}

.username {
  font-size:17px;
  font-weight:bold;
}

.userid {
  font-size:12px;
  color:#555;
}

/* ------- MODAL ------- */
#profile-modal {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.85);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:2000;
}

#profile-modal img {
  width:75%;
  max-width:350px;
  border-radius:50%;
}

/* ------- BUTTON ------- */
#add-btn {
  margin-top:20px;
  padding:10px 16px;
  background:#2196f3;
  color:white;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loading-screen">
  <div id="loading-title">FCHAT</div>
  <div id="loading-logs">Starting...</div>
</div>

<!-- MAIN UI -->
<div id="main-ui">
  <h2>Your Chats</h2>
  <button id="add-btn" onclick="location.href='add.html'">Add Friends</button>
  <div id="users-list"></div>
</div>

<!-- PROFILE MODAL -->
<div id="profile-modal">
  <img id="modal-img">
</div>

<script>

/* ---------------- LOADING LOGS ---------------- */
async function runLoadingSequence() {
  const logs = [
    "Starting...",
    "Preparing modules...",
    "Checking storage...",
    "Loading chats...",
    "Finalizing..."
  ];

  const logBox = document.getElementById("loading-logs");

  for (let i = 0; i < logs.length; i++) {
    logBox.textContent = logs[i];
    await new Promise(res => setTimeout(res, 600));
  }

  // After logs â†’ load main UI
  showMainUI();
  loadSavedChats();
}

/* ---------------- SHOW MAIN UI ---------------- */
function showMainUI() {
  document.getElementById("loading-screen").style.display = "none";
  document.getElementById("main-ui").style.display = "block";
}

/* ---------------- LOAD LOCAL CHATS ---------------- */
function loadSavedChats() {
  const chats = JSON.parse(localStorage.getItem("fchat_messages")) || [];
  displayChats(chats);
}

/* ---------------- DISPLAY FCARDS ---------------- */
function displayChats(chats) {
  const box = document.getElementById("users-list");
  box.innerHTML = "";

  chats.forEach(user => {
    const card = document.createElement("div");
    card.className = "fcard";

    let pfp = document.createElement("div");
    pfp.className = "pfp";

    if (user.profile_pic) {
      let img = document.createElement("img");
      img.src = user.profile_pic;
      img.style.width = "100%";
      img.style.height = "100%";
      img.style.borderRadius = "50%";

      pfp.appendChild(img);

      pfp.onclick = () => {
        document.getElementById("profile-modal").style.display = "flex";
        document.getElementById("modal-img").src = user.profile_pic;
      };
    } else {
      let initials = user.username?.[0]?.toUpperCase() || "U";
      pfp.textContent = initials;
    }

    let info = document.createElement("div");
    info.innerHTML = `
      <div class="username">${user.username}</div>
      <div class="userid">ID: ${user.id}</div>
    `;

    card.appendChild(pfp);
    card.appendChild(info);
    box.appendChild(card);
  });
}

/* ---------------- CLOSE MODAL ---------------- */
document.getElementById("profile-modal").onclick = () => {
  document.getElementById("profile-modal").style.display = "none";
};

/* ---------------- START ---------------- */
runLoadingSequence();

</script>

</body>
  </html>
