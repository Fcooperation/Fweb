<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Friend Requests</title>
<style>
  body { font-family: sans-serif; background: #f5f7fa; padding: 20px; }
  .fchat-card { background: #fff; padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
  .fchat-card img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
  .buttons button { margin-left: 5px; }
</style>
</head>
<body>
<h2>Friend Requests</h2>
<div id="friend-requests"></div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabaseUrl = "https://pwsxezhugsxosbwhkdvf.supabase.co";
const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3c3hlemh1Z3N4b3Nid2hrZHZmIiwicm9sZSIsImlhdCI6MTc1MTkyODM4NywiZXhwIjoyMDY3NTA0Mzg3fQ.u7lU9gAE-hbFprFIDXQlep4q2bhjj0QdlxXF-kylVBQ";

const supabase = createClient(supabaseUrl, supabaseAnonKey);

async function loadFriendRequests() {
  const faccount = JSON.parse(localStorage.getItem("faccount"));
  if (!faccount || !faccount.id) {
    alert("No account found in local storage. Please log in.");
    return;
  }

  const userId = faccount.id;

  // Fetch your own full data using id
  const { data: userData, error: userError } = await supabase
    .from("fwebaccount")
    .select("*")
    .eq("id", userId)
    .maybeSingle();

  if (userError || !userData) {
    console.error("Error fetching user:", userError);
    alert("Error fetching user data.");
    return;
  }

  const friendRequestIds = userData.friend_request || []; // assume array of ids
  const container = document.getElementById("friend-requests");

  if (!friendRequestIds.length) {
    container.innerHTML = "<p>No friend requests.</p>";
    return;
  }

  container.innerHTML = ""; // clear

  // Fetch each requester data
  for (let fid of friendRequestIds) {
    const { data: fdata } = await supabase
      .from("fwebaccount")
      .select("id, username, profile_pic")
      .eq("id", fid)
      .maybeSingle();

    if (fdata) {
      const card = document.createElement("div");
      card.className = "fchat-card";
      card.innerHTML = `
        <div style="display:flex; align-items:center;">
          <img src="${fdata.profile_pic || 'default.png'}" alt="${fdata.username}">
          <span>${fdata.username}</span>
        </div>
        <div class="buttons">
          <button disabled>Accept</button>
          <button disabled>Reject</button>
        </div>
      `;
      container.appendChild(card);
    }
  }
}

loadFriendRequests();
</script>
</body>
</html>
